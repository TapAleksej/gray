- name: Check if local OpenSearch package exists
  stat:
    path: "{{ playbook_dir }}/roles/graylog_offline_install/files/{{ opensearch_rpms[0] }}"
  register: opensearch_local_file

- name: Install OpenSearch locally (offline)
  when: opensearch_local_file.stat.exists
  block:
    - name: Copy local OpenSearch RPM
      become: true
      copy:
        src: "{{ opensearch_rpms[0] }}"
        dest: /tmp/

    - name: Install OpenSearch RPM with password
      become: true
      environment:
        OPENSEARCH_INITIAL_ADMIN_PASSWORD: "{{ opensearch_admin_password }}"
      command: "dnf install -y /tmp/{{ opensearch_rpms[0] }}"